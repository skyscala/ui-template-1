aW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7CmltcG9ydCB7Q291bnRyeVNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2UvY291bnRyeXNlcnZpY2UnOwppbXBvcnQge0JyZWFkY3J1bWJTZXJ2aWNlfSBmcm9tICcuLi8uLi9hcHAuYnJlYWRjcnVtYi5zZXJ2aWNlJzsKCkBDb21wb25lbnQoewogICAgdGVtcGxhdGVVcmw6ICcuL2Zsb2F0bGFiZWxkZW1vLmNvbXBvbmVudC5odG1sJywKICAgIHN0eWxlVXJsczogWycuL2Zsb2F0bGFiZWxkZW1vLnNjc3MnXQp9KQpleHBvcnQgY2xhc3MgRmxvYXRMYWJlbERlbW9Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQgewoKICAgIGNvdW50cmllczogYW55W107CgogICAgY2l0aWVzOiBhbnlbXTsKCiAgICBmaWx0ZXJlZENvdW50cmllczogYW55W107CgogICAgdmFsdWUxOiBhbnk7CgogICAgdmFsdWUyOiBhbnk7CgogICAgdmFsdWUzOiBhbnk7CgogICAgdmFsdWU0OiBhbnk7CgogICAgdmFsdWU1OiBhbnk7CgogICAgdmFsdWU2OiBhbnk7CgogICAgdmFsdWU3OiBhbnk7CgogICAgdmFsdWU4OiBhbnk7CgogICAgdmFsdWU5OiBhbnk7CgogICAgdmFsdWUxMDogYW55OwoKICAgIHZhbHVlMTE6IGFueTsKCiAgICB2YWx1ZTEyOiBhbnk7CgogICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb3VudHJ5U2VydmljZTogQ291bnRyeVNlcnZpY2UsIHByaXZhdGUgYnJlYWRjcnVtYlNlcnZpY2U6IEJyZWFkY3J1bWJTZXJ2aWNlKSB7CiAgICAgICAgdGhpcy5icmVhZGNydW1iU2VydmljZS5zZXRJdGVtcyhbCiAgICAgICAgICAgIHtsYWJlbDogJ0Zsb2F0IExhYmVsJ30KICAgICAgICBdKTsKICAgICAgICB0aGlzLmNpdGllcyA9IFsKICAgICAgICAgICAge25hbWU6ICdOZXcgWW9yaycsIGNvZGU6ICdOWSd9LAogICAgICAgICAgICB7bmFtZTogJ1JvbWUnLCBjb2RlOiAnUk0nfSwKICAgICAgICAgICAge25hbWU6ICdMb25kb24nLCBjb2RlOiAnTEROJ30sCiAgICAgICAgICAgIHtuYW1lOiAnSXN0YW5idWwnLCBjb2RlOiAnSVNUJ30sCiAgICAgICAgICAgIHtuYW1lOiAnUGFyaXMnLCBjb2RlOiAnUFJTJ30KICAgICAgICBdOwogICAgfQoKICAgIG5nT25Jbml0KCkgewogICAgICAgIHRoaXMuY291bnRyeVNlcnZpY2UuZ2V0Q291bnRyaWVzKCkudGhlbihjb3VudHJpZXMgPT4gewogICAgICAgICAgICB0aGlzLmNvdW50cmllcyA9IGNvdW50cmllczsKICAgICAgICB9KTsKICAgIH0KCiAgICBzZWFyY2hDb3VudHJ5KGV2ZW50KSB7CiAgICAgICAgLy8gaW4gYSByZWFsIGFwcGxpY2F0aW9uLCBtYWtlIGEgcmVxdWVzdCB0byBhIHJlbW90ZSB1cmwgd2l0aCB0aGUgcXVlcnkgYW5kCiAgICAgICAgLy8gcmV0dXJuIGZpbHRlcmVkIHJlc3VsdHMsIGZvciBkZW1vIHdlIGZpbHRlciBhdCBjbGllbnQgc2lkZQogICAgICAgIGNvbnN0IGZpbHRlcmVkOiBhbnlbXSA9IFtdOwogICAgICAgIGNvbnN0IHF1ZXJ5ID0gZXZlbnQucXVlcnk7CiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1mb3Itb2YKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY291bnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGNvdW50cnkgPSB0aGlzLmNvdW50cmllc1tpXTsKICAgICAgICAgICAgaWYgKGNvdW50cnkubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgPT0gMCkgewogICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChjb3VudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5maWx0ZXJlZENvdW50cmllcyA9IGZpbHRlcmVkOwogICAgfQp9Cg