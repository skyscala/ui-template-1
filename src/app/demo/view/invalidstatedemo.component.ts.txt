aW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7CmltcG9ydCB7Q291bnRyeVNlcnZpY2V9IGZyb20gJy4uL3NlcnZpY2UvY291bnRyeXNlcnZpY2UnOwppbXBvcnQge0JyZWFkY3J1bWJTZXJ2aWNlfSBmcm9tICcuLi8uLi9hcHAuYnJlYWRjcnVtYi5zZXJ2aWNlJzsKCkBDb21wb25lbnQoewogICAgdGVtcGxhdGVVcmw6ICcuL2ludmFsaWRzdGF0ZWRlbW8uY29tcG9uZW50Lmh0bWwnCn0pCmV4cG9ydCBjbGFzcyBJbnZhbGlkU3RhdGVEZW1vQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHsKCgogICAgY291bnRyaWVzOiBhbnlbXTsKCiAgICBjaXRpZXM6IGFueVtdOwoKICAgIGZpbHRlcmVkQ291bnRyaWVzOiBhbnlbXTsKCiAgICB2YWx1ZTE6IGFueTsKCiAgICB2YWx1ZTI6IGFueTsKCiAgICB2YWx1ZTM6IGFueTsKCiAgICB2YWx1ZTQ6IGFueTsKCiAgICB2YWx1ZTU6IGFueTsKCiAgICB2YWx1ZTY6IGFueTsKCiAgICB2YWx1ZTc6IGFueTsKCiAgICB2YWx1ZTg6IGFueTsKCiAgICB2YWx1ZTk6IGFueTsKCiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvdW50cnlTZXJ2aWNlOiBDb3VudHJ5U2VydmljZSwgcHJpdmF0ZSBicmVhZGNydW1iU2VydmljZTogQnJlYWRjcnVtYlNlcnZpY2UpIHsKICAgICAgICB0aGlzLmJyZWFkY3J1bWJTZXJ2aWNlLnNldEl0ZW1zKFsKICAgICAgICAgICAge2xhYmVsOiAnSW52YWxpZCBTdGF0ZSd9CiAgICAgICAgXSk7CgogICAgICAgIHRoaXMuY2l0aWVzID0gWwogICAgICAgICAgICB7bmFtZTogJ05ldyBZb3JrJywgY29kZTogJ05ZJ30sCiAgICAgICAgICAgIHtuYW1lOiAnUm9tZScsIGNvZGU6ICdSTSd9LAogICAgICAgICAgICB7bmFtZTogJ0xvbmRvbicsIGNvZGU6ICdMRE4nfSwKICAgICAgICAgICAge25hbWU6ICdJc3RhbmJ1bCcsIGNvZGU6ICdJU1QnfSwKICAgICAgICAgICAge25hbWU6ICdQYXJpcycsIGNvZGU6ICdQUlMnfQogICAgICAgIF07CiAgICB9CgogICAgbmdPbkluaXQoKSB7CiAgICAgICAgdGhpcy5jb3VudHJ5U2VydmljZS5nZXRDb3VudHJpZXMoKS50aGVuKGNvdW50cmllcyA9PiB7CiAgICAgICAgICAgIHRoaXMuY291bnRyaWVzID0gY291bnRyaWVzOwogICAgICAgIH0pOwogICAgfQoKICAgIHNlYXJjaENvdW50cnkoZXZlbnQpIHsKICAgICAgICAvLyBpbiBhIHJlYWwgYXBwbGljYXRpb24sIG1ha2UgYSByZXF1ZXN0IHRvIGEgcmVtb3RlIHVybCB3aXRoIHRoZSBxdWVyeSBhbmQgcmV0dXJuIGZpbHRlcmVkIHJlc3VsdHMsCiAgICAgICAgLy8gZm9yIGRlbW8gd2UgZmlsdGVyIGF0IGNsaWVudCBzaWRlCiAgICAgICAgY29uc3QgZmlsdGVyZWQ6IGFueVtdID0gW107CiAgICAgICAgY29uc3QgcXVlcnkgPSBldmVudC5xdWVyeTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY291bnRyaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGNvdW50cnkgPSB0aGlzLmNvdW50cmllc1tpXTsKICAgICAgICAgICAgaWYgKGNvdW50cnkubmFtZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YocXVlcnkudG9Mb3dlckNhc2UoKSkgPT0gMCkgewogICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChjb3VudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5maWx0ZXJlZENvdW50cmllcyA9IGZpbHRlcmVkOwogICAgfQp9Cg