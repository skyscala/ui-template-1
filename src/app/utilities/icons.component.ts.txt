aW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7CmltcG9ydCB7IEljb25TZXJ2aWNlIH0gZnJvbSAnLi4vZGVtby9zZXJ2aWNlL2ljb25zZXJ2aWNlJzsKaW1wb3J0IHtCcmVhZGNydW1iU2VydmljZX0gZnJvbSAnLi4vYXBwLmJyZWFkY3J1bWIuc2VydmljZSc7CgpAQ29tcG9uZW50KHsKICAgIHRlbXBsYXRlVXJsOiAnLi9pY29ucy5jb21wb25lbnQuaHRtbCcsCiAgICBzdHlsZVVybHM6IFsnLi9pY29ucy5zY3NzJ10KfSkKZXhwb3J0IGNsYXNzIEljb25zQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHsKCiAgICBpY29uczogYW55IFtdOwoKICAgIGZpbHRlcmVkSWNvbnM6IGFueSBbXTsKCiAgICBzZWxlY3RlZEljb246IGFueTsKCiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGljb25TZXJ2aWNlOiBJY29uU2VydmljZSwgcHJpdmF0ZSBicmVhZGNydW1iU2VydmljZTogQnJlYWRjcnVtYlNlcnZpY2UpIHsKICAgICAgICB0aGlzLmJyZWFkY3J1bWJTZXJ2aWNlLnNldEl0ZW1zKFsKICAgICAgICAgICAge2xhYmVsOiAnSWNvbnMnfQogICAgICAgIF0pOwogICAgfQoKICAgIG5nT25Jbml0KCkgewoJCXRoaXMuaWNvblNlcnZpY2UuZ2V0SWNvbnMoKS5zdWJzY3JpYmUoZGF0YSA9PiB7CiAgICAgICAgICAgIGRhdGEgPSBkYXRhLmZpbHRlcih2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUuaWNvbi50YWdzLmluZGV4T2YoJ2RlcHJlY2F0ZScpID09PSAtMTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBsZXQgaWNvbnMgPSBkYXRhOwogICAgICAgICAgICBpY29ucy5zb3J0KChpY29uMSwgaWNvbjIpID0-IHsKICAgICAgICAgICAgICAgIGlmKGljb24xLnByb3BlcnRpZXMubmFtZSA8IGljb24yLnByb3BlcnRpZXMubmFtZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICBlbHNlIGlmKGljb24xLnByb3BlcnRpZXMubmFtZSA8IGljb24yLnByb3BlcnRpZXMubmFtZSkKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB0aGlzLmljb25zID0gaWNvbnM7CgkJCXRoaXMuZmlsdGVyZWRJY29ucyA9IGRhdGE7CgkJfSk7Cgl9CgogICAgb25GaWx0ZXIoZXZlbnQ6IEtleWJvYXJkRXZlbnQpOiB2b2lkIHsKICAgICAgICBjb25zdCBzZWFyY2hUZXh0ID0gKGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZTsKCiAgICAgICAgaWYgKCFzZWFyY2hUZXh0KSB7CiAgICAgICAgICAgIHRoaXMuZmlsdGVyZWRJY29ucyA9IHRoaXMuaWNvbnM7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbHRlcmVkSWNvbnMgPSB0aGlzLmljb25zLmZpbHRlciggaXQgPT4gewogICAgICAgICAgICAgICAgcmV0dXJuIGl0Lmljb24udGFnc1swXS5pbmNsdWRlcyhzZWFyY2hUZXh0KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQp9Cg